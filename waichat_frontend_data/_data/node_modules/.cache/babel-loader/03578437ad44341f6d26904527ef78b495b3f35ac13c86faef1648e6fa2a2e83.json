{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext}from'react';import{useNavigate}from'react-router-dom';import api from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[token,setToken]=useState(localStorage.getItem('token'));const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();useEffect(()=>{const loadUser=async()=>{if(token){api.defaults.headers.common['Authorization']=`Bearer ${token}`;try{const response=await api.get('/auth/me');setUser(response.data);}catch(error){localStorage.removeItem('token');setToken(null);api.defaults.headers.common['Authorization']='';}}setLoading(false);};loadUser();},[token]);const login=async credentials=>{try{setError(null);const response=await api.post('/auth/login',credentials);const{user,token,redirectToAdmin}=response.data;localStorage.setItem('token',token);api.defaults.headers.common['Authorization']=`Bearer ${token}`;setUser(user);setToken(token);return{user,redirectToAdmin};}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Errore durante il login');throw error;}};const register=async userData=>{try{setError(null);const response=await api.post('/auth/register',userData);const{user,token}=response.data;localStorage.setItem('token',token);api.defaults.headers.common['Authorization']=`Bearer ${token}`;setUser(user);setToken(token);return user;}catch(error){var _error$response2,_error$response2$data;setError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Errore durante la registrazione');throw error;}};const logout=async()=>{try{if(token){await api.post('/auth/logout');}}catch(error){console.error('Errore durante il logout:',error);}finally{localStorage.removeItem('token');api.defaults.headers.common['Authorization']='';setUser(null);setToken(null);navigate('/login');}};const isAuthenticated=!!user;const value={user,loading,error,isAuthenticated,login,register,logout};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(context===undefined){throw new Error('useAuth deve essere usato all\\'interno di un AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","useNavigate","api","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","token","setToken","localStorage","getItem","loading","setLoading","error","setError","navigate","loadUser","defaults","headers","common","response","get","data","removeItem","login","credentials","post","redirectToAdmin","setItem","_error$response","_error$response$data","message","register","userData","_error$response2","_error$response2$data","logout","console","isAuthenticated","value","Provider","useAuth","context","undefined","Error"],"sources":["/app/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport api from '../services/api';\n\nconst AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(localStorage.getItem('token'));\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  \n  const navigate = useNavigate();\n  \n  useEffect(() => {\n    const loadUser = async () => {\n      if (token) {\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        try {\n          const response = await api.get('/auth/me');\n          setUser(response.data);\n        } catch (error) {\n          localStorage.removeItem('token');\n          setToken(null);\n          api.defaults.headers.common['Authorization'] = '';\n        }\n      }\n      setLoading(false);\n    };\n    \n    loadUser();\n  }, [token]);\n  \n  const login = async (credentials) => {\n    try {\n      setError(null);\n      const response = await api.post('/auth/login', credentials);\n      const { user, token, redirectToAdmin } = response.data;\n      \n      localStorage.setItem('token', token);\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      \n      setUser(user);\n      setToken(token);\n      \n      return { user, redirectToAdmin };\n    } catch (error) {\n      setError(error.response?.data?.message || 'Errore durante il login');\n      throw error;\n    }\n  };\n  \n  const register = async (userData) => {\n    try {\n      setError(null);\n      const response = await api.post('/auth/register', userData);\n      const { user, token } = response.data;\n      \n      localStorage.setItem('token', token);\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      \n      setUser(user);\n      setToken(token);\n      \n      return user;\n    } catch (error) {\n      setError(error.response?.data?.message || 'Errore durante la registrazione');\n      throw error;\n    }\n  };\n  \n  const logout = async () => {\n    try {\n      if (token) {\n        await api.post('/auth/logout');\n      }\n    } catch (error) {\n      console.error('Errore durante il logout:', error);\n    } finally {\n      localStorage.removeItem('token');\n      api.defaults.headers.common['Authorization'] = '';\n      setUser(null);\n      setToken(null);\n      navigate('/login');\n    }\n  };\n  \n  const isAuthenticated = !!user;\n  \n  const value = {\n    user,\n    loading,\n    error,\n    isAuthenticated,\n    login,\n    register,\n    logout\n  };\n  \n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth deve essere usato all\\'interno di un AuthProvider');\n  }\n  return context;\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}